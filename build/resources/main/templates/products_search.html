<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Search Products</title>

    <script src="https://unpkg.com/htmx.org@1.9.2"></script>

    <style>
        body { font-family: Georgia, serif; padding: 20px; }

        input[type="search"] {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }

        .spinner {
            width: 18px; height: 18px;
            border-radius: 50%;
            border: 3px solid rgba(0,0,0,0.2);
            border-top-color: black;
            animation: spin 1s linear infinite;
            display: none;
            margin-top: 8px;
        }
        [hx-indicator].htmx-request .spinner {
            display: inline-block;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 16px;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 10px;
        }
        th { background: #f4f4f4; }
    </style>
</head>

<body>

<h1>Search Products</h1>

<!-- Search input -->
<input
        id="search-id"
        name="title"
        placeholder="Type product title..."
        type="search"
        hx-get="/products/search/results"
        hx-trigger="keyup changed delay:300ms"
        hx-target="#search-results"
        hx-swap="outerHTML"
        autocomplete="off"
        hx-indicator="#spinner"
/>


<div id="spinner" class="spinner"></div>

<!-- Results container -->
<div id="search-results">
    <p>Start typing to search...</p>
</div>


<!-- =============================== -->
<!-- Thymeleaf Fragment Returned by Controller -->
<!-- =============================== -->
<div th:fragment="searchResults">
    <div id="search-results">

        <div th:if="${products != null and not #lists.isEmpty(products)}">
            <table>
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Title</th>
                    <th>Handle</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="p : ${products}">
                    <td th:text="${p.id}"></td>
                    <td th:text="${p.title}"></td>
                    <td th:text="${p.handle}"></td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- Empty â†’ return nothing -->
        <div th:if="${products != null and #lists.isEmpty(products)}"></div>

    </div>
</div>

</body>
</html>
