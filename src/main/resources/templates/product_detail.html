<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Admin - Product Detail</title>

    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.2"></script>

    <!-- Web Awesome Theme + loader -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/@awesome.me/webawesome@3.0.0/dist-cdn/styles/themes/default.css">
    <script type="module"
            src="https://cdn.jsdelivr.net/npm/@awesome.me/webawesome@3.0.0/dist-cdn/webawesome.loader.js">
    </script>

    <!-- Admin CSS -->
    <link rel="stylesheet" th:href="@{/admin_styles.css}">
</head>

<body>
<div class="layout">
    <aside class="sidebar" th:replace="common/sidebar :: sidebar"></aside>

    <div class="content-wrap">
        <div class="topbar">
            <div><strong>Product Detail</strong></div>
            <div class="muted">Logged in as Admin</div>
        </div>

        <main class="page">
            <!-- Use wa-card for consistent WA look -->
            <wa-card style="max-width:900px;">
                <h2 slot="title">Update Product</h2>

                <!-- Stack for spacing -->
                <div class="wa-stack" style="gap:16px;">

                    <!-- HTMX form â€” preserve hx-put binding -->
                    <form th:action="@{/products/{id}(id=${product.id})}"
                          th:attr="hx-put=@{/products/{id}(id=${product.id})}"
                          method="post"
                          hx-target="#update-result"
                          hx-swap="innerHTML">

                        <!-- Grid: two columns on wide screens -->
                        <div class="form-grid">
                            <div class="wa-field">
                                <label for="title">Title</label>
                                <input id="title" name="title" type="text" th:value="${product.title}" required />
                            </div>
                            <br>
                            <div class="wa-field">
                                <label for="handle">Handle</label>
                                <input id="handle" name="handle" type="text" th:value="${product.handle}" />
                            </div>
                            <br>
                            <div class="wa-field">
                                <label for="vendor">Vendor</label>
                                <input id="vendor" name="vendor" type="text" th:value="${product.vendor}" />
                            </div>
                            <br>
                            <div class="wa-field">
                                <label for="productType">Product Type</label>
                                <input id="productType" name="productType" type="text" th:value="${product.productType}" />
                            </div>
                        </div> <!-- /.form-grid -->

                        <!-- Actions: Save uses the form submit; Back uses HTMX navigation -->
                        <div class="actions">
                            <wa-button type="submit" variant="success">Save</wa-button>
                            <wa-button type="button" onclick="window.location.href='/products'">Back</wa-button>
                        </div>
                    </form>

                    <!-- Inline update message (auto-hide after 3s) -->
                    <div id="update-result"></div>

                </div> <!-- /.wa-stack -->
            </wa-card>

        </main>
    </div>
</div>

<!-- success fragment remains -->
<th:block th:fragment="productUpdated">
    <div id="update-result" style="padding:8px 0;">
        <div style="padding:10px; border-radius:4px; border:1px solid #e6e6e6; background:#fff;">
            <div>
                <p style="margin:0; color:var(--wa-color-primary);">
                    Product "<span th:text="${product.title}">Product Name</span>" has been updated.
                </p>
            </div>
        </div>
    </div>
</th:block>

<script>
    // keep the auto-hide behaviour
    document.body.addEventListener("htmx:afterSwap", function () {
        const updateResult = document.getElementById('update-result');
        if (updateResult && updateResult.innerText.trim().length > 0) {
            if (updateResult._hideTimer) clearTimeout(updateResult._hideTimer);
            updateResult._hideTimer = setTimeout(() => {
                updateResult.innerHTML = "";
            }, 3000);
        }
    });
</script>
</body>
</html>
